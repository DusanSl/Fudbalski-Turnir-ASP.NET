@model IEnumerable<FudbalskiTurnir.ViewModels.UtakmicaViewModel>
@{
    ViewData["Title"] = "Rezultati Turnira";
}

<div class="container">
    <h2 class="display-6 fw-bold animate-title">Rezultati svih utakmica</h2>

    <div class="row mb-3 animate-filter">
        <div class="col-md-4">
            <label for="turnirFilter" class="fs-3 form-label">Izaberite turnir:</label>
            <select id="turnirFilter" class="form-select bg-dark text-white border-primary shadow-none">
                <option value="" class="bg-dark text-white">Svi turniri</option>
                @if (Model != null)
                {
                    @foreach (var grupa in Model.Where(u => u.TurnirID.HasValue).GroupBy(u => u.TurnirID))
                    {
                        <option value="@grupa.Key" class="bg-dark text-white">@grupa.First().NazivTurnira</option>
                    }
                }
            </select>
        </div>
    </div>

    <div class="table-responsive animate-table">
        <table id="rezultatiTable" class="display cell-border rezultati-table" style="width:100%">
            <thead>
                <tr>
                    <th></th>
                    <th>Datum i vreme</th>
                    <th>Domaćin</th>
                    <th>Rezultat</th>
                    <th>Gost</th>
                    <th>Kolo / Grupa</th>
                    <th class="d-none d-lg-table-cell">Mesto</th>
                    <th class="d-none d-md-table-cell">Napomena</th>
                    <th class="d-none">TurnirID_Hidden</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var utakmica in Model)
                {
                    <tr class="rezultati">
                        <td class="control-icon"></td>
                        <td data-order="@utakmica.Datum.ToString("yyyyMMddHHmm")">
                            @utakmica.Datum.ToString("dd.MM.yyyy. HH:mm")
                        </td>
                        <td>@utakmica.PrviKlubNaziv</td>
                        <td>
                            <span class="responsiveTable px-3 py-2">
                                @(utakmica.PrviKlubGolovi) : @(utakmica.DrugiKlubGolovi)
                            </span>
                        </td>
                        <td>@utakmica.DrugiKlubNaziv</td>
                        <td>
                            @utakmica.Kolo
                            @if (!string.IsNullOrEmpty(utakmica.Grupa))
                            {
                                <span>(Grupa @utakmica.Grupa)</span>
                            }
                        </td>
                        <td class="d-none d-lg-table-cell text-white-50">@utakmica.Mesto</td>
                        <td class="d-none d-md-table-cell">
                            @if (utakmica.PrviKlubPenali.HasValue)
                            {
                                <span class="text-danger fw-bold small">Penali (@utakmica.PrviKlubPenali-@utakmica.DrugiKlubPenali)</span>
                            }
                            else if (utakmica.Produzeci)
                            {
                                <span class="text-warning fw-bold small">Produžeci</span>
                            }
                        </td>
                        <td class="d-none">@utakmica.TurnirID</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            var table = $('#rezultatiTable').DataTable({
                "responsive": {
                    "details": {
                        "type": "column",
                        "target": 0,
                        "renderer": function (api, rowIdx, columns) {
                            var data = '<table class="table table-sm table-dark table-borderless mb-0">';
                            $.each(columns, function (i, col) {
                                if (i > 0 && i !== 7) {
                                    data += '<tr>' +
                                            '<td class="text-white-50 fw-bold" style="width: 40%;">' + col.title + '</td>' +
                                            '<td class="text-white">' + col.data + '</td>' +
                                            '</tr>';
                                }
                            });
                            data += '</table>';
                            return data;
                        }
                    }
                },
                "columnDefs": [
                    {
                        "className": "control",
                        "orderable": false,
                        "targets": 0
                    },
                    {
                        "targets": 8,
                        "visible": false
                    }
                ],
                "paging": true,
                "searching": true,
                "ordering": true,
                "info": true,
                "autoWidth": false,
                "zeroRecords": "Nema rezultata",
                "emptyTable": "Nema podataka u tabeli",
                "order": [[1, "desc"]],
                "language": {
                    "search": "Filter unutar tabele:",
                    "info": "Prikaz _START_ do _END_ od ukupno _TOTAL_ utakmica",
                    "infoEmpty": "Prikazivanje 0 do 0 od 0 entiteta",
                    "infoFiltered": "(filtrirano od ukupno _MAX_ entiteta)",
                    "lengthMenu": "Prikažite _MENU_ entiteta",
                    "paginate": {
                        "first": "Prva",
                        "last": "Poslednja",
                        "next": "Sledeća",
                        "previous": "Prethodna"
                    },
                "zeroRecords": "Nema rezultata",
                "emptyTable": "Nema podataka u tabeli"
                }
            });

            $('#turnirFilter').on('change', function () {
                var val = $(this).val();
                if (val === "") {
                    table.column(8).search('').draw();
                } else {
                    table.column(8).search('^' + val + '$', true, false).draw();
                }
            });
        });
    </script>
}