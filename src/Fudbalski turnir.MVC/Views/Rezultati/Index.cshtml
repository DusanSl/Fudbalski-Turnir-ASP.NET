@model IEnumerable<FudbalskiTurnir.ViewModels.UtakmicaViewModel>
@{
    ViewData["Title"] = "Rezultati Turnira";
}

<div class="container mt-4">
    <h2 class="mb-4">Sve Utakmice</h2>

    <div class="row mb-3">
        <div class="col-md-4">
            <label for="turnirFilter" class="form-label fw-bold">Izaberite turnir:</label>
            <select id="turnirFilter" class="form-select bg-dark text-white border-primary shadow-none">
                <option value="" class="bg-dark text-white">Svi turniri</option>
                @if (Model != null)
                {
                    @foreach (var grupa in Model.Where(u => u.TurnirID.HasValue).GroupBy(u => u.TurnirID))
                    {
                        <option value="@grupa.Key" class="bg-dark text-white">@grupa.First().NazivTurnira</option>
                    }
                }
            </select>
        </div>
    </div>

    <div class="table-responsive">
        <table id="rezultatiTable" class="display cell-border" style="width:100%">
            <thead>
                <tr>
                    <th>Datum i vreme</th>
                    <th>Kolo / Grupa</th>
                    <th>Domaćin</th>
                    <th>Rezultat</th>
                    <th>Gost</th>
                    <th class="d-none d-lg-table-cell">Mesto</th>
                    <th class="d-none d-md-table-cell">Napomena</th>
                    <th class="d-none">TurnirID_Hidden</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var utakmica in Model)
                {
                    <tr class="rezultati">
                        @* KLJUČNA PROMENA: data-order omogućava hronološko sortiranje *@
                        <td data-order="@utakmica.Datum.ToString("yyyyMMddHHmm")">
                            @utakmica.Datum.ToString("dd.MM.yyyy. HH:mm")
                        </td>
                        <td>
                            @utakmica.Kolo
                            @if (!string.IsNullOrEmpty(utakmica.Grupa))
                            {
                                <span>(Grupa @utakmica.Grupa)</span>
                            }
                        </td>
                        <td>@utakmica.PrviKlubNaziv</td>
                        <td>
                            <span class="scoreBadge px-3 py-2">
                                @(utakmica.PrviKlubGolovi) : @(utakmica.DrugiKlubGolovi)
                            </span>
                        </td>
                        <td>@utakmica.DrugiKlubNaziv</td>
                        <td class="d-none d-lg-table-cell text-white-50">@utakmica.Mesto</td>
                        <td class="d-none d-md-table-cell">
                            @if (utakmica.PrviKlubPenali.HasValue)
                            {
                                <span class="text-danger fw-bold small">Penali (@utakmica.PrviKlubPenali-@utakmica.DrugiKlubPenali)</span>
                            }
                            else if (utakmica.Produzeci)
                            {
                                <span class="text-warning fw-bold small">Produžeci</span>
                            }
                        </td>
                        <td class="d-none">@utakmica.TurnirID</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            var table = $('#rezultatiTable').DataTable({
                "paging": true,
                "searching": true,
                "ordering": true,
                "info": true,
                "responsive": true,
                "autoWidth": false,
                "order": [[0, "desc"]], // Sortira prvu kolonu (Datum) unazad
                "language": {
                    "search": "Filter unutar tabele:",
                    "info": "Prikaz _START_ do _END_ od ukupno _TOTAL_ utakmica",
                    "paginate": {
                        "next": "Sledeća",
                        "previous": "Prethodna"
                    }
                }
            });

            $('#turnirFilter').on('change', function () {
                var val = $(this).val();
                if (val === "") {
                    table.column(7).search('').draw();
                } else {
                    table.column(7).search('^' + val + '$', true, false).draw();
                }
            });
        });
    </script>
}